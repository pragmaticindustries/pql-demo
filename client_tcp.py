import socket
from datetime import datetime

from iotdb.utils.IoTDBConstants import TSDataType
from iotdb.utils.Tablet import Tablet

from tcp_interface import CommunicationPacketHeader, CommunicationPacket
from write_into_iotdb import insert_tablet

HOST = '127.0.0.1'  # The server's hostname or IP address
PORT = 7210  # The port used by the server

data_bytes = b'\xf4\x6b\x8c\x49\xa1\xbb\x7e\x00\xda\xfc\xef\x39\x08\x00\x45\x00' \
       b'\x05\xdc\x53\xe3\x40\x00\x40\x06\x5f\x82\xc0\xa8\x00\x02\xc0\xa8' \
       b'\x00\x64\x1c\x2a\xd3\x7e\x3c\xe3' \
       b'\x2b\x0e\x24\x87\x62\x3c\x50\x10' \
       b'\x01\xf6\xb4\x52\x00\x00\x7a\xc7\xab\x41\xc2\xe0\xf6\xf0\x84\xc7' \
       b'\xab\x41\x76\xff\xfb\xe0\x8f\xc7\xab\x41\x2a\x1e\x01\xd1\x9a\xc7' \
       b'\xab\x41\xde\x3c\x06\xc1\xa5\xc7\xab\x41\x92\x5b\x0b\xb1\xb0\xc7' \
       b'\xab\x41\x46\x7a\x10\xa1\xbb\xc7\xab\x41\xfa\x98\x15\x91\xc6\xc7' \
       b'\xab\x41\xae\xb7\x1a\x81\xd1\xc7\xab\x41\x62\xd6\x1f\x71\xdc\xc7' \
       b'\xab\x41\x16\xf5\x24\x61\xe7\xc7\xab\x41\xca\x13\x2a\x51\xf2\xc7' \
       b'\xab\x41\x7e\x32\x2f\x41\xfd\xc7\xab\x41\x32\x51\x34\x31\x08\xc8' \
       b'\xab\x41\xe6\x6f\x39\x21\x13\xc8\xab\x41\x9a\x8e\x3e\x11\x1e\xc8' \
       b'\xab\x41\x4e\xad\x43\x01\x29\xc8\xab\x41\x02\xcc\x48\xf1\x33\xc8' \
       b'\xab\x41\xb6\xea\x4d\xe1\x3e\xc8\xab\x41\x6a\x09\x53\xd1\x49\xc8' \
       b'\xab\x41\x1e\x28\x58\xc1\x54\xc8\xab\x41\xd2\x46\x5d\xb1\x5f\xc8' \
       b'\xab\x41\x86\x65\x62\xa1\x6a\xc8\xab\x41\x3a\x84\x67\x91\x75\xc8' \
       b'\xab\x41\xee\xa2\x6c\x81\x80\xc8\xab\x41\xa2\xc1\x71\x71\x8b\xc8' \
       b'\xab\x41\x56\xe0\x76\x61\x96\xc8\xab\x41\x0a\xff\x7b\x51\xa1\xc8' \
       b'\xab\x41\xbe\x1d\x81\x41\xac\xc8\xab\x41\x72\x3c\x86\x31\xb7\xc8' \
       b'\xab\x41\x26\x5b\x8b\x21\xc2\xc8\xab\x41\xda\x79\x90\x11\xcd\xc8' \
       b'\xab\x41\x8e\x98\x95\x01\xd8\xc8\xab\x41\x42\xb7\x9a\xf1\xe2\xc8' \
       b'\xab\x41\xf6\xd5\x9f\xe1\xed\xc8\xab\x41\xaa\xf4\xa4\xd1\xf8\xc8' \
       b'\xab\x41\x5e\x13\xaa\xc1\x03\xc9\xab\x41\x12\x32\xaf\xb1\x0e\xc9' \
       b'\xab\x41\xc6\x50\xb4\xa1\x19\xc9\xab\x41\x7a\x6f\xb9\x91\x24\xc9' \
       b'\xab\x41\x2e\x8e\xbe\x81\x2f\xc9\xab\x41\xe2\xac\xc3\x71\x3a\xc9' \
       b'\xab\x41\x96\xcb\xc8\x61\x45\xc9\xab\x41\x4a\xea\xcd\x51\x50\xc9' \
       b'\xab\x41\xfe\x08\xd3\x41\x5b\xc9\xab\x41\xb2\x27\xd8\x31\x66\xc9' \
       b'\xab\x41\x66\x46\xdd\x21\x71\xc9\xab\x41\x1a\x65\xe2\x11\x7c\xc9' \
       b'\xab\x41\xce\x83\xe7\x01\x87\xc9\xab\x41\x82\xa2\xec\xf1\x91\xc9' \
       b'\xab\x41\x36\xc1\xf1\xe1\x9c\xc9\xab\x41\xea\xdf\xf6\xd1\xa7\xc9' \
       b'\xab\x41\x9e\xfe\xfb\xc1\xb2\xc9\xab\x41\x52\x1d\x01\xb2\xbd\xc9' \
       b'\xab\x41\x06\x3c\x06\xa2\xc8\xc9\xab\x41\xba\x5a\x0b\x92\xd3\xc9' \
       b'\xab\x41\x6e\x79\x10\x82\xde\xc9\xab\x41\x22\x98\x15\x72\xe9\xc9' \
       b'\xab\x41\xd6\xb6\x1a\x62\xf4\xc9\xab\x41\x8a\xd5\x1f\x52\xff\xc9' \
       b'\xab\x41\x3e\xf4\x24\x42\x0a\xca\xab\x41\xf2\x12\x2a\x32\x15\xca' \
       b'\xab\x41\xa6\x31\x2f\x22\x20\xca\xab\x41\x5a\x50\x34\x12\x2b\xca' \
       b'\xab\x41\x0e\x6f\x39\x02\x36\xca\xab\x41\xc2\x8d\x3e\xf2\x40\xca' \
       b'\xab\x41\x76\xac\x43\xe2\x4b\xca\xab\x41\x2a\xcb\x48\xd2\x56\xca' \
       b'\xab\x41\xde\xe9\x4d\xc2\x61\xca\xab\x41\x92\x08\x53\xb2\x6c\xca' \
       b'\xab\x41\x46\x27\x58\xa2\x77\xca\xab\x41\xfa\x45\x5d\x92\x82\xca' \
       b'\xab\x41\xae\x64\x62\x82\x8d\xca\xab\x41\x62\x83\x67\x72\x98\xca' \
       b'\xab\x41\x16\xa2\x6c\x62\xa3\xca\xab\x41\xca\xc0\x71\x52\xae\xca' \
       b'\xab\x41\x7e\xdf\x76\x42\xb9\xca\xab\x41\x32\xfe\x7b\x32\xc4\xca' \
       b'\xab\x41\xe6\x1c\x81\x22\xcf\xca\xab\x41\x9a\x3b\x86\x12\xda\xca' \
       b'\xab\x41\x4e\x5a\x8b\x02\xe5\xca\xab\x41\x02\x79\x90\xf2\xef\xca' \
       b'\xab\x41\xb6\x97\x95\xe2\xfa\xca\xab\x41\x6a\xb6\x9a\xd2\x05\xcb' \
       b'\xab\x41\x1e\xd5\x9f\xc2\x10\xcb\xab\x41\xd2\xf3\xa4\xb2\x1b\xcb' \
       b'\xab\x41\x86\x12\xaa\xa2\x26\xcb\xab\x41\x3a\x31\xaf\x92\x31\xcb' \
       b'\xab\x41\xee\x4f\xb4\x82\x3c\xcb\xab\x41\xa2\x6e\xb9\x72\x47\xcb' \
       b'\xab\x41\x56\x8d\xbe\x62\x52\xcb\xab\x41\x0a\xac\xc3\x52\x5d\xcb' \
       b'\xab\x41\xbe\xca\xc8\x42\x68\xcb\xab\x41\x72\xe9\xcd\x32\x73\xcb' \
       b'\xab\x41\x26\x08\xd3\x22\x7e\xcb\xab\x41\xda\x26\xd8\x12\x89\xcb' \
       b'\xab\x41\x8e\x45\xdd\x02\x94\xcb\xab\x41\x42\x64\xe2\xf2\x9e\xcb' \
       b'\xab\x41\xf6\x82\xe7\xe2\xa9\xcb\xab\x41\xaa\xa1\xec\xd2\xb4\xcb' \
       b'\xab\x41\x5e\xc0\xf1\xc2\xbf\xcb\xab\x41\x12\xdf\xf6\xb2\xca\xcb' \
       b'\xab\x41\xc6\xfd\xfb\xa2\xd5\xcb\xab\x41\x7a\x1c\x01\x93\xe0\xcb' \
       b'\xab\x41\x2e\x3b\x06\x83\xeb\xcb\xab\x41\xe2\x59\x0b\x73\xf6\xcb' \
       b'\xab\x41\x96\x78\x10\x63\x01\xcc\xab\x41\x4a\x97\x15\x53\x0c\xcc' \
       b'\xab\x41\xfe\xb5\x1a\x43\x17\xcc\xab\x41\xb2\xd4\x1f\x33\x22\xcc' \
       b'\xab\x41\x66\xf3\x24\x23\x2d\xcc\xab\x41\x1a\x12\x2a\x13\x38\xcc' \
       b'\xab\x41\xce\x30\x2f\x03\x43\xcc\xab\x41\x82\x4f\x34\xf3\x4d\xcc' \
       b'\xab\x41\x36\x6e\x39\xe3\x58\xcc\xab\x41\xea\x8c\x3e\xd3\x63\xcc' \
       b'\xab\x41\x9e\xab\x43\xc3\x6e\xcc\xab\x41\x52\xca\x48\xb3\x79\xcc' \
       b'\xab\x41\x06\xe9\x4d\xa3\x84\xcc\xab\x41\xba\x07\x53\x93\x8f\xcc' \
       b'\xab\x41\x6e\x26\x58\x83\x9a\xcc\xab\x41\x22\x45\x5d\x73\xa5\xcc' \
       b'\xab\x41\xd6\x63\x62\x63\xb0\xcc\xab\x41\x8a\x82\x67\x53\xbb\xcc' \
       b'\xab\x41\x3e\xa1\x6c\x43\xc6\xcc\xab\x41\xf2\xbf\x71\x33\xd1\xcc' \
       b'\xab\x41\xa6\xde\x76\x23\xdc\xcc\xab\x41\x5a\xfd\x7b\x13\xe7\xcc' \
       b'\xab\x41\x0e\x1c\x81\x03\xf2\xcc\xab\x41\xc2\x3a\x86\xf3\xfc\xcc' \
       b'\xab\x41\x76\x59\x8b\xe3\x07\xcd\xab\x41\x2a\x78\x90\xd3\x12\xcd' \
       b'\xab\x41\xde\x96\x95\xc3\x1d\xcd\xab\x41\x92\xb5\x9a\xb3\x28\xcd' \
       b'\xab\x41\x46\xd4\x9f\xa3\x33\xcd\xab\x41\xfa\xf2\xa4\x93\x3e\xcd' \
       b'\xab\x41\xae\x11\xaa\x83\x49\xcd\xab\x41\x62\x30\xaf\x73\x54\xcd' \
       b'\xab\x41\x16\x4f\xb4\x63\x5f\xcd\xab\x41\xca\x6d\xb9\x53\x6a\xcd' \
       b'\xab\x41\x7e\x8c\xbe\x43\x75\xcd\xab\x41\x32\xab\xc3\x33\x80\xcd' \
       b'\xab\x41\xe6\xc9\xc8\x23\x8b\xcd\xab\x41\x9a\xe8\xcd\x13\x96\xcd' \
       b'\xab\x41\x4e\x07\xd3\x03\xa1\xcd\xab\x41\x02\x26\xd8\xf3\xab\xcd' \
       b'\xab\x41\xb6\x44\xdd\xe3\xb6\xcd\xab\x41\x6a\x63\xe2\xd3\xc1\xcd' \
       b'\xab\x41\x1e\x82\xe7\xc3\xcc\xcd\xab\x41\xd2\xa0\xec\xb3\xd7\xcd' \
       b'\xab\x41\x86\xbf\xf1\xa3\xe2\xcd\xab\x41\x3a\xde\xf6\x93\xed\xcd' \
       b'\xab\x41\xee\xfc\xfb\x83\xf8\xcd\xab\x41\xa2\x1b\x01\x74\x03\xce' \
       b'\xab\x41\x56\x3a\x06\x64\x0e\xce\xab\x41\x0a\x59\x0b\x54\x19\xce' \
       b'\xab\x41\xbe\x77\x10\x44\x24\xce\xab\x41\x72\x96\x15\x34\x2f\xce' \
       b'\xab\x41\x26\xb5\x1a\x24\x3a\xce\xab\x41\xda\xd3\x1f\x14\x45\xce' \
       b'\xab\x41\x8e\xf2\x24\x04\x50\xce\xab\x41\x42\x11\x2a\xf4\x5a\xce' \
       b'\xab\x41\xf6\x2f\x2f\xe4\x65\xce\xab\x41\xaa\x4e\x34\xd4\x70\xce' \
       b'\xab\x41\x5e\x6d\x39\xc4\x7b\xce\xab\x41\x12\x8c\x3e\xb4\x86\xce' \
       b'\xab\x41\xc6\xaa\x43\xa4\x91\xce\xab\x41\x7a\xc9\x48\x94\x9c\xce' \
       b'\xab\x41\x2e\xe8\x4d\x84\xa7\xce\xab\x41\xdf\xba\xfe\xaf\xd0\xba' \
       b'\xfe\xaf\xb0\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
       b'\x00\x00\xc4\x00\x00\x00\x0f\x00\x00\x00\x02\x10\x01\x10\x00\x00' \
       b'\x00\x00\xb0\x05\x00\x00\xac\x05\x00\x00\xaa\x00\x00\x00\xe2\x06' \
       b'\x53\x74\xb2\xce\xab\x41\x96\x25\x58\x64\xbd\xce\xab\x41\x4a\x44' \
       b'\x5d\x54\xc8\xce\xab\x41\xfe\x62\x62\x44\xd3\xce\xab\x41\xb2\x81' \
       b'\x67\x34\xde\xce\xab\x41\x66\xa0\x6c\x24\xe9\xce\xab\x41\x1a\xbf' \
       b'\x71\x14\xf4\xce\xab\x41\xce\xdd\x76\x04'

values_ = [
    [False, 10, 11, 1.1, 10011.1, "test01"],
    [True, 100, 11111, 1.25, 101.0, "test02"],
    [False, 100, 1, 188.1, 688.25, "test03"],
    [True, 0, 0, 0, 6.25, "test04"],
]  # Non-ASCII text will cause error since bytes can only hold 0-128 nums.
timestamps_ = [4, 5, 6, 7]
measurements_ = ["s_01", "s_02", "s_03", "s_04", "s_05", "s_06"]
# values_ = [False, 10, 11, 1.1, 10011.1, "test_record"]
data_types_ = [
    TSDataType.BOOLEAN,
    TSDataType.INT32,
    TSDataType.INT64,
    TSDataType.FLOAT,
    TSDataType.DOUBLE,
    TSDataType.TEXT,
]
# tablet_ = Tablet(
#     "root.sg_test_01.d_01", measurements_, data_types_, values_, timestamps_
# )
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect((HOST, PORT))
# def test():
    header:CommunicationPacketHeader = CommunicationPacketHeader()
    header.id=5
    header.size=5
    data_paket:CommunicationPacket = CommunicationPacket()
    data_paket.header = header
    # data_paket.data = bytearray(123)
    # s.sendall(data_paket.data)
    # s.sendall(bytes([72,65,76,76]))
    bytes_to_send = bytes([1,2,3,4])
    print(bytes_to_send)
    s.sendall(bytes_to_send)
    # s.sendall(bytes(f'packet{data_paket}'))
    data:bytes = s.recv(4)
    zahlen_arry = list(tuple(data))
    print(len(zahlen_arry))
    # tablet:Tablet = Tablet(f"root.murr22.{1}",
    #                        [["zahl1"],
    #                         ["zahl2"],
    #                         ["zahl3"],
    #                         ["zahl4"]]
    #                        [TSDataType.INT64]
    #                        ,zahlen_arry,
    #                        [datetime.now()])
    tablet = Tablet(
        "root.sg_test_01.d_01", measurements_, data_types_, values_, timestamps_
    )
    insert_tablet(tablet)
    ### Hier dann write into iotdb .......
    # print('{}'.format(data.decode('UTF-8')))
print(f'Received {data!r}')
# bis Zeile 33 Header
# bytes erstmal in ein Array immer nach dem \ spliten dann umrechnen in decimal
# https://stackoverflow.com/questions/52192830/converting-bytes-inside-a-tuple-to-string das Gegenst√ºck
# https://www.delftstack.com/de/howto/python/how-to-convert-bytes-to-integers/
